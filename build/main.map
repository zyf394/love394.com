{"version":3,"sources":["webpack:///webpack/bootstrap 59d22f2cb33d4c16b59f","webpack:///./~/babel-runtime/regenerator/index.js","webpack:///./utils/errno.js","webpack:///./utils/ctx.js","webpack:///external \"moment\"","webpack:///external \"path\"","webpack:///external \"url\"","webpack:///./nuxt.config.js","webpack:///./server/routes/index.js","webpack:///external \"koa\"","webpack:///external \"nuxt\"","webpack:///./server/api/index.js","webpack:///./server/api/member.js","webpack:///./server/api/user.js","webpack:///./server/db/auth.js","webpack:///./server/db/index.js","webpack:///./server/token/index.js","webpack:///external \"fs\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-mongo\"","webpack:///external \"koa-router\"","webpack:///external \"koa-session2\"","webpack:///external \"mongodb\"","webpack:///external \"objectid-to-timestamp\"","webpack:///external \"postcss-px2rem\"","webpack:///external \"querystring\"","webpack:///external \"regenerator-runtime\"","webpack:///external \"sha1\"","webpack:///external \"webpack\"","webpack:///./server/index.js"],"names":["SUCCESS","errno","errmsg","MEMBER_EXIST","MEMBER_ENROLLED","MEMBER_NOT_CLASSMATE","MEMBER_PAYED","USER_NAME_REGISTERED","USER_EMAIL_REGISTERED","USER_EMAIL_NOT_REGISTERED","USER_PASSWORD_INCORRECT","USER_NOT_EXIST","INTERNAL_ERROR","ctx","next","type","body","ERRORS","console","error","method","path","responseError","data","responseSuccess","require","join","resolve","fs","webpack","content","readFileSync","module","exports","router","middleware","head","title","meta","charset","name","hid","link","rel","href","script","innerHTML","__dangerouslyDisableSanitizers","css","src","lang","loading","color","build","rules","test","loaders","loader","query","limit","use","exclude","vendor","postcss","remUnit","app","nuxt","createApi","session","key","mongo","user","auth","username","pass","password","host","port","db","bodyParser","routes","allowedMethods","status","render","req","res","member","post","add","edit","remove","get","findAll","editAll","request","collection","find","toArray","exits","length","phone","is_payed","is_enrolled","enrolled_time","Date","payed_time","insert","result","_id","ObjectId","deleteOne","ok","log","findOne","url","parse","skipNum","page","limitNum","parseInt","pageSize","skip","list","slice","i","update","pay_time","upsert","keys","Object","exist","_serielizeUpdate","updateOne","now","forEach","item","moment","format","existName","email","existEmail","sha1","token","createToken","create_time","signup","userExist","cookies","set","signin","all","memberCache","userCache","MemberModel","User","user_email","jwt","sign","expiresIn","header","split","decoded","decode","exp","message","checkToken","config","dev","env","process","exit","listen","start","HOST","PORT"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 29);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 59d22f2cb33d4c16b59f","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/regenerator/index.js\n// module id = 0\n// module chunks = 0","export default {\n  SUCCESS: {\n    errno: 0,\n    errmsg: 'success'\n  },\n  MEMBER_EXIST: {\n    errno: 10000,\n    errmsg: '成员已添加过了'\n  },\n  MEMBER_ENROLLED: {\n    errno: 10001,\n    errmsg: '您已报过名'\n  },\n  MEMBER_NOT_CLASSMATE: {\n    errno: 10002,\n    errmsg: '您非本班成员，无法报名'\n  },\n  MEMBER_PAYED: {\n    errno: 10003,\n    errmsg: '您已交费'\n  },\n  USER_NAME_REGISTERED: {\n    errno: 20000,\n    errmsg: '用户姓名已注册'\n  },\n  USER_EMAIL_REGISTERED: {\n    errno: 20001,\n    errmsg: '用户邮箱已注册'\n  },\n  USER_EMAIL_NOT_REGISTERED: {\n    errno: 20002,\n    errmsg: '用户邮箱未注册'\n  },\n  USER_PASSWORD_INCORRECT: {\n    errno: 20003,\n    errmsg: '用户密码错误'\n  },\n  USER_NOT_EXIST: {\n    errno: 20004,\n    errmsg: '用户不存在'\n  },\n  INTERNAL_ERROR: {\n    errno: 99999,\n    errmsg: '系统内部错误'\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./utils/errno.js","import ERRORS from './errno'\n\nexport async function responseError(ctx, next, type) {\n  try {\n    ctx.body = {\n      errno: ERRORS[type].errno,\n      errmsg: ERRORS[type].errmsg\n    }\n    if (typeof next === 'function') {\n      await next()\n    }\n  } catch (e) {\n    console.error(`[ERROR CONTEXT]: ${ctx.method} ${ctx.path} in responseError \\n[ERROR STACK]:\\n`, e)\n  }\n}\nexport async function responseSuccess(ctx, next, data = {}) {\n  try {\n    ctx.body = {\n      errno: 0,\n      errmsg: 'success',\n      data\n    }\n    if (typeof next === 'function') {\n      await next()\n    }\n  } catch (e) {\n    console.error(`[ERROR CONTEXT]: ${ctx.method} ${ctx.path} in responseSuccess \\n[ERROR STACK]:\\n`, e)\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./utils/ctx.js","module.exports = require(\"moment\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"moment\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"url\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"url\"\n// module id = 5\n// module chunks = 0","const { join, resolve } = require('path')\nconst fs = require('fs')\nconst webpack = require('webpack');\nconst content = fs.readFileSync(resolve('./assets/js/rem.js'), 'utf8')\n\nmodule.exports = {\n  /*\n  ** Headers of the page\n  */\n  router: {\n    middleware: 'check-auth'\n  },\n  head: {\n    title: 'love394',\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1, user-scalable=no' },\n      { name: 'format-detection', content: 'telephone=no' },\n      { hid: 'description', name: 'description', content: 'Nuxt.js project' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\n    ],\n    script: [\n      {\n        innerHTML: content\n      }\n    ],\n    __dangerouslyDisableSanitizers: ['script']\n  },\n  /*\n  ** Global CSS\n  */\n  css: [\n    {\n      src: resolve('./assets/css/reset.styl'),\n      lang: 'stylus'\n    },\n    {\n      src: resolve('./assets/css/variable.styl'),\n      lang: 'stylus'\n    },\n    {\n      src: resolve('./assets/css/main.styl'),\n      lang: 'stylus'\n    } // 指定 scss 而非 sass\n  ],\n  /*\n  ** Customize the progress-bar color\n  */\n  loading: {\n    color: '#ffaca8'\n  },\n  build: {\n    module: {\n      rules: [\n        {\n          // 在页面中加载图片示例：var imgstr = require(\"./imgs/3.png\")\n          test: /\\.(jpe?g|png|gif|svg)$/i,\n          loaders: [\n            {\n              loader: 'url-loader',\n              query: {\n                limit: 8192,\n                name: 'images/[name].[hash].[ext]'\n              }\n            }\n          ]\n        },\n        {\n          test: /\\.html$/,\n          use: ['html-loader']\n        },\n        {\n          test: /\\.(pug|jade)$/,\n          use: ['pug-loader']\n        },\n        {\n          // 编译es6\n          test: /\\.js$/,\n          exclude: /node_modules/,\n          use: ['babel-loader']\n        }\n      ]\n    },\n    vendor: [\n      'axios'\n    ],\n    postcss: [\n      require('postcss-px2rem')({remUnit: 46.875})\n    ]\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","import path from 'path'\nimport Router from 'koa-router'\nimport createApi from '../api'\nimport auth from '../db/auth'\nimport mongo from 'koa-mongo'\nimport bodyParser from 'koa-bodyparser'\nimport session from 'koa-session2'\n\nexport default function(app, nuxt) {\n  const router = new Router()\n\n  createApi(router)\n\n  app\n    .use(session({\n      key: \"SESSIONID\"\n    }))\n\n  app\n    .use(mongo({\n      user: auth.username,\n      pass: auth.password,\n      host: '127.0.0.1',\n      port: 27017,\n      db: 'member'\n    }))\n    .use(bodyParser())\n    .use(router.routes())\n    .use(router.allowedMethods())\n    .use(async (ctx, next) => {\n      ctx.status = 200 // koa defaults to 404 when it sees that status is unset\n      await nuxt.render(ctx.req, ctx.res)\n    })\n}\n\n\n// WEBPACK FOOTER //\n// ./server/routes/index.js","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 9\n// module chunks = 0","import member from './member'\nimport user from './user'\nexport default function(router) {\n  member(router)\n  user(router)\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/index.js","import querystring from 'querystring'\nimport url from 'url'\nimport moment from 'moment'\nimport { ObjectId } from 'mongodb'\nimport { responseError, responseSuccess } from '../../utils/ctx'\nimport ERRORS from '../../utils/errno'\nimport { MemberModel } from '../db/index'\nexport default function (router) {\n  router.post('/api/member/add', add)\n  router.post('/api/member/edit', edit)\n  router.post('/api/member/remove', remove)\n  router.get('/api/member/list', findAll)\n  router.post('/api/member/list', editAll)\n}\n\nexport async function add (ctx, next) {\n  const req = ctx.request.body\n  const query = { name: req.name }\n  const exits = await ctx.mongo.db('member').collection('member').find(query).toArray()\n\n  if (exits.length) {\n    responseError(ctx, next, 'MEMBER_EXIST')\n  } else {\n    const member = {\n      name: req.name || '',\n      phone: req.phone || '',\n      is_payed: req.is_payed || 0,\n      is_enrolled: req.is_enrolled || 0,\n      enrolled_time: +new Date(),\n      payed_time: +new Date()\n    }\n    const result = await ctx.mongo.db('member').collection('member').insert(member)\n    responseSuccess(ctx, next, result)\n  }\n}\nexport async function remove (ctx, next) {\n  const query = ctx.request.body || {}\n  query._id = ObjectId(query._id)\n  try {\n    const result = await ctx.mongo.db('member').collection('member').deleteOne(query)\n    if (result.result.ok) {\n      responseSuccess(ctx, next, result)\n    }\n  } catch (e) {\n    console.log(e)\n  }\n}\nexport async function findOne (ctx, next) {\n  const query = ctx.request.body || {}\n  query._id = ObjectId(query._id)\n  const result = await ctx.mongo.db('member').collection('member').find(query).toArray()\n  responseSuccess(ctx, next, result)\n}\n\nexport async function findAll(ctx, next) {\n  const query = url.parse(ctx.request.url, true).query\n  const skipNum = (query.page - 1) * 10\n  const limitNum = parseInt(query.pageSize)\n  try {\n    const result = await ctx.mongo.db('member').collection('member').find({}).skip(skipNum).limit(limitNum).toArray()\n    responseSuccess(ctx, next, result)\n  } catch (e) {\n    console.log(e)\n    responseError(ctx, next, 'INTERNAL_ERROR')\n  }\n}\nexport async function editAll(ctx, next) {\n  const req = ctx.request.body\n  const list = (req.data || []).slice()\n  try {\n    for (let i = 0; i < list.length; i++) {\n      let query = {\n        _id: ObjectId(list[i]._id)\n      }\n      let update = {\n        '$set': {\n          name: list[i].name,\n          phone: list[i].phone,\n          is_payed: list[i].is_payed,\n          is_enrolled: list[i].is_enrolled,\n          enrolled_time: list[i].enrolled_time,\n          pay_time: list[i].pay_time\n        }\n      }\n      await ctx.mongo.db('member').collection('member').update(query, update, { upsert: true })\n    }\n    const result = await ctx.mongo.db('member').collection('member').find({}).toArray()\n    responseSuccess(ctx, next, result)\n  } catch (e) {\n    responseError(ctx, next, 'INTERNAL_ERROR')\n  }\n}\nexport async function edit (ctx, next) {\n  let req = ctx.request.body\n  let keys = Object.keys(req)\n  let query = {\n    name: req.name\n  }\n  let update = {}\n  const exist = await ctx.mongo.db('member').collection('member').find(query).toArray()\n\n  if (exist.length) {\n    if (req.is_enrolled && exist[0].is_enrolled) {\n      responseError(ctx, next, 'MEMBER_ENROLLED')\n    } else if (req.is_payed && exist[0].is_payed) {\n      responseError(ctx, next, 'MEMBER_PAYED')\n    } else {\n      update = _serielizeUpdate(req)\n      try {\n        const result = await ctx.mongo.db('member').collection('member').updateOne(query, update)\n        if (result.result.ok) {\n          responseSuccess(ctx, next)\n        } else {\n          console.log(result.result)\n        }\n      } catch (e) {\n        console.log(e)\n      }\n    }\n  } else {\n    responseError(ctx, next, 'MEMBER_NOT_CLASSMATE')\n  }\n}\n\nfunction _serielizeUpdate (req) {\n  let update = {}\n  let now = +new Date()\n  let query = req\n  let keys = Object.keys(req)\n  keys.forEach(item => {\n    if (!update['$set']) {\n      update['$set'] = {}\n    }\n    if (item !== '_id') {\n      if (item === 'is_enrolled' && query.is_enrolled === 1) {\n        update['$set']['enrolled_time'] = moment(now).format('YYYY-MM-DD HH:mm:ss')\n      }\n      if (item === 'is_payed' && query.is_payed === 1) {\n        update['$set']['payed_time'] = moment(now).format('YYYY-MM-DD HH:mm:ss')\n      }\n      update['$set'][item] = req[item]\n    }\n  })\n  return update\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/api/member.js","import moment from 'moment'\nimport objectIdToTimestamp from 'objectid-to-timestamp'\nimport sha1 from 'sha1'\nimport url from 'url'\nimport { createToken } from '../token'\nimport { responseError, responseSuccess } from '../../utils/ctx'\nimport ERRORS from '../../utils/errno'\n\nexport default function (router) {\n  router.all('/api/user/signup', signup)\n  router.all('/api/user/signin', signin)\n  router.post('/api/user/get', get)\n}\n\nasync function signup (ctx, next) {\n  let req = ctx.method === 'GET' \n              ? url.parse(ctx.request.url, true).query\n              : ctx.request.body\n  let existName = await ctx.mongo.db('member').collection('user').find({ username: req.username || ''}).toArray()\n  let existEmail = await ctx.mongo.db('member').collection('user').find({ email: req.email || ''}).toArray()\n\n  if (existName.length) {\n    responseError(ctx, next, 'USER_NAME_REGISTERED')\n  } else {\n    if (existEmail.length) {\n      responseError(ctx, next, 'USER_EMAIL_REGISTERED')\n    } else {\n      let now = +new Date()\n      let user = {\n        username: req.username,\n        email: req.email,\n        password: sha1(req.password), // 加密\n        token: createToken(req.email), // 创建token并存入数据库\n        create_time: moment(now).format('YYYY-MM-DD HH:mm:ss')\n      }\n      let result = await ctx.mongo.db('member').collection('user').insert(user)\n\n      responseSuccess(ctx, next)\n    }\n  }\n}\n\nasync function signin (ctx, next) {\n  let req = ctx.method === 'GET' \n            ? url.parse(ctx.request.url, true).query\n            : ctx.request.body\n\n  let email = req.email\n  let password = sha1(req.password);\n  let userExist = await ctx.mongo.db('member').collection('user').find({ email }).toArray()\n\n  if (!userExist.length) {\n    responseError(ctx, next, 'USER_EMAIL_NOT_REGISTERED')\n  } else {\n    let user = userExist[0]\n    if (user.password === password) {\n      //生成一个新的token,并存到数据库\n      let token = createToken(email)\n      let query = { email }\n      let update = { '$set': user}\n      user.token = token\n\n      let result = await ctx.mongo.db('member').collection('user').updateOne(query, update)\n\n      ctx.cookies.set('token', token)\n      responseSuccess(ctx, next, { email, token }) // TODO 登录成功要创建一个新的token,应该存入数据库\n\n    } else{\n      responseError(ctx, next, 'USER_PASSWORD_INCORRECT')\n    }\n  }\n}\n\nasync function get (ctx, next) {\n  let req = ctx.request.body\n  let token = req.token\n  let userExist = await ctx.mongo.db('member').collection('user').find({ token }).toArray()\n\n  if (!userExist.length) {\n    responseError(ctx, 'USER_NOT_EXIST')\n  } else {\n    let user = userExist[0]\n    responseSuccess(ctx, { user })\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/user.js","export default {\n  username: 'shuiyi',\n  password: 'Zyf$394394'\n}\n\n\n// WEBPACK FOOTER //\n// ./server/db/auth.js","let memberCache\nlet userCache\n\nexport function MemberModel (ctx) {\n  if (!memberCache) {\n    memberCache = ctx.mongo.db('member').collection('member')\n  }\n  return memberCache\n}\n\nexport function User (ctx) {\n  if (!userCache) {\n    userCache = ctx.mongo.db('member').collection('user')\n  }\n  return userCache\n}\n\n\n// WEBPACK FOOTER //\n// ./server/db/index.js","import jwt from 'jsonwebtoken'\n\nexport function createToken(user_email) {\n  const token = jwt.sign({ user_email: user_email }, 'love394', { expiresIn: '720h' })\n  return token\n}\n\nexport async function checkToken(ctx, next) {\n  if(ctx.request.header['authorization']){\n    let token = ctx.request.header['authorization'].split(' ')[1]\n    let decoded = jwt.decode(token, 'love394');\n\n    if(token && decoded.exp <= new Date()/1000){\n      ctx.status = 401;\n      ctx.body = {\n        message: 'token过期'\n      }\n    } else {\n      return next()\n    }\n  }else{\n      ctx.status = 401\n      ctx.body = {\n          message: '没有token'\n      }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./server/token/index.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"koa-mongo\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-mongo\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"koa-session2\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-session2\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"mongodb\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongodb\"\n// module id = 22\n// module chunks = 0","module.exports = require(\"objectid-to-timestamp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"objectid-to-timestamp\"\n// module id = 23\n// module chunks = 0","module.exports = require(\"postcss-px2rem\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"postcss-px2rem\"\n// module id = 24\n// module chunks = 0","module.exports = require(\"querystring\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"querystring\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"sha1\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sha1\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"webpack\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack\"\n// module id = 28\n// module chunks = 0","import Koa from 'koa'\n\nimport Nuxt from 'nuxt'\n\nimport routes from './routes'\n\nconst app = new Koa()\nconst host = process.env.HOST || '0.0.0.0'\nconst port = process.env.PORT || 3000\n\n// Start nuxt.js\nasync function start () {\n  // Import and Set Nuxt.js options\n  let config = require('../nuxt.config.js')\n  config.dev = !(app.env === 'production')\n  // Instanciate nuxt.js\n  const nuxt = await new Nuxt(config)\n  // Build in development\n  if (config.dev) {\n    try {\n      await nuxt.build()\n    } catch (e) {\n      console.error(e) // eslint-disable-line no-console\n      process.exit(1)\n    }\n  }\n\n  routes(app, nuxt)\n  \n  app.listen(port, host)\n  console.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n}\n\nstart()\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js"],"sourceRoot":""}